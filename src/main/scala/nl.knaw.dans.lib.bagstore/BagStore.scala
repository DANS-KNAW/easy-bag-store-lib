/**
 * Copyright (C) 2018 DANS - Data Archiving and Networked Services (info@dans.knaw.nl)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package nl.knaw.dans.lib.bagstore

import java.io.{ OutputStream, File => JFile }
import java.util.UUID

import better.files._
import nl.knaw.dans.lib.bagstore.ArchiveStreamType.ArchiveStreamType

import scala.util.Try

/**
 * Object that encapsulates a new or existing bag store.
 *
 * @param baseDir         the base-dir of the bag store
 * @param optSlashPattern the slash-pattern to use
 */
class BagStore(baseDir: File, optSlashPattern: Option[SlashPattern] = None) {

  /**
   * Adds a bag to the bag store. A UUID to use as bag-id may be provided. If it is not, it is
   * generated by the function. The bag must be virtually-valid in the context of this bag store.
   *
   * @param bag     the bag to add
   * @param optUuid the UUID to use as bag-id
   * @return the BagId of the added bag
   */
  def add(bag: Bag, optUuid: Option[UUID] = None): Try[BagId] = ???

  /**
   * Copies the referenced item to `target`. If target already exists, the function will
   * fail, unless `overwrite = true` is specified.
   *
   * @param itemId    the item to copy
   * @param target    the location to write item to
   * @param overwrite first remove existing file or directory in the target location
   * @return
   */
  def get(itemId: ItemId, target: File, overwrite: Boolean = false): Try[Unit] = ???

  /**
   * Writes the referenced item to `target` output stream. If an archive stream type is specified, the
   * item is packaged in the corresponding archive format (e.g., ZIP, TAR). For Bag and Directory items
   * this is mandatory.
   *
   * @param itemId               the item to write
   * @param target               the output stream to write the item to
   * @param optArchiveStreamType the archive stream type to use, if any
   * @return
   */
  def stream(itemId: ItemId, target: => OutputStream, optArchiveStreamType: Option[ArchiveStreamType] = None): Try[Unit] = ???


  /**
   * Enumerates all the bags in the bag store. By default only active bags will be returned. The optional boolean
   * parameters let you override this behavior.
   *
   * @param includeActive   whether to include the active bags
   * @param includeInactive whether to include include the deactivated bags
   * @return
   */
  def enumBags(includeActive: Boolean = true, includeInactive: Boolean = false): Try[Stream[Try[BagId]]] = ???


  /**
   * Enumerates the files in a bag. By default only regular files are returned. The optional boolean parameters let
   * you override this behavior.
   *
   * @param bagId the bag to enumerate
   * @param includeRegularFiles whether to include regular files
   * @param includeDirectories whether to include directories
   */
  def enumFiles(bagId: BagId, includeRegularFiles: Boolean = true, includeDirectories: Boolean = false): Try[Stream[Try[FileId]]] = ???


}
